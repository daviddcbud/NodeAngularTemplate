var express= require('express');
var mongoose= require('mongoose');

var db=mongoose.connect('mongodb://dev:pointe@ds061741.mongolab.com:61741/devtesting');

var Book=require('./models/bookModel');
var bodyParser=require('body-parser');


var app= express();

var port= process.env.PORT || 3000;

app.use(bodyParser.json());
app.use(bodyParser.urlencoded({extended:true}));


var bookRouter= express.Router();

app.use('/api', bookRouter);

bookRouter.route('/Books').
post(function(req,res) {
	var book=new Book(req.body);
	book.save();
	res.stats(201).send(book);
}).
get(function(req, res) {
	var responseJson={hello:'this is my api'};

	console.log(req.query);
	Book.find(req.query,function(err, books) {
		console.log(books);
		if (err) res.status(500).send(err);
		else
		  res.json(books);
	});

});

bookRouter.route('/Books/:id').get(function(req,res) 
		{
Book.findById(req.params.id, function(err, book)  {
     if (err) res.status(404).send('not found');
     res.json(book);
});

		});

app.get('/', function(req,res) {
	res.send('welcome');

});

app.listen(port, function() {
	console.log('running on port', port);
});

